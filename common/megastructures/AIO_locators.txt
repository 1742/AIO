# AIO定位器

AIO_mega_country_locator = {
	entity = "none"
	construction_entity = "none"
	place_entity_on_planet_plane = yes
	build_type = inside_gravity_well

	portrait = "GFX_megastructure_spy_orb_background"

	potential = {
		OR = {
			has_country_flag = AIO_RE_ASLT_locating
			has_country_flag = AIO_RE_uncausality_locating
			has_country_flag = AIO_RE_design_requirement_locating
			has_country_flag = AIO_RE_superlight_locating
			has_country_flag = AIO_RE_change_government_locating

			has_country_flag = AIO_RE_demilitarization_locating
			has_country_flag = AIO_RE_erase_country_locating
		}
	}
	possible = { exists = owner }
	dismantle_potential = { always = no }

	build_time = 1

	on_build_start = {
		event_target:AIO_locator_builder = { delete_fleet = this }
		clear_global_event_target = AIO_locator_builder

		from = {
			switch = {
				trigger = has_country_flag
				AIO_RE_ASLT_locating = {
					remove_country_flag = AIO_RE_ASLT_locating
					set_country_flag = AIO_RE_ASLT_located
				}
				AIO_RE_uncausality_locating = {
					remove_country_flag = AIO_RE_uncausality_locating
					set_country_flag = AIO_RE_uncausality_located
				}
				AIO_RE_design_requirement_locating = {
					remove_country_flag = AIO_RE_design_requirement_locating
					set_country_flag = AIO_RE_design_requirement_located
				}
				AIO_RE_superlight_locating = {
					remove_country_flag = AIO_RE_superlight_locating
					set_country_flag = AIO_RE_superlight_located
				}
				AIO_RE_change_government_locating = {
					remove_country_flag = AIO_RE_change_government_locating
					set_country_flag = AIO_RE_change_government_located
				}

				AIO_RE_demilitarization_locating = {
					remove_country_flag = AIO_RE_demilitarization_locating
					set_country_flag = AIO_RE_demilitarization_located

					# 记录信息
					root.owner = {
						set_variable = { which = AIO_RE_demilitarization_num value = trigger:count_used_naval_cap }
					}
				}
				AIO_RE_erase_country_locating = {
					remove_country_flag = AIO_RE_erase_country_locating
					set_country_flag = AIO_RE_erase_country_located

					# 记录信息
					root.owner = {
						set_variable = { which = AIO_RE_erase_country_system_num value = trigger:count_system_within_border }
						set_variable = { which = AIO_RE_erase_country_colony_num value = trigger:count_owned_planet }
						set_variable = { which = AIO_RE_erase_country_species_num value = trigger:count_owned_species }
						set_variable = { which = AIO_RE_erase_country_pop_num value = trigger:count_owned_pop_amount }
						divide_variable = { which = AIO_RE_erase_country_pop_num value = 1000 }
						floor_variable = AIO_RE_erase_country_pop_num
						set_variable = { which = AIO_RE_erase_country_navy_num value = trigger:count_used_naval_cap }
					}
				}
			}

			root.owner = { save_global_event_target_as = AIO_RE_target }
			country_event = { id = AIO_RE_events.201 }
		}
	}

	on_build_complete = { remove_megastructure = fromfrom }
}

AIO_mega_system_locator = {
	entity = "none"
	construction_entity = "none"
	place_entity_on_planet_plane = yes
	build_type = inside_gravity_well

	portrait = "GFX_megastructure_spy_orb_background"

	potential = {
		OR = {
			has_country_flag = AIO_RE_enrich_system_deposits_locating
			has_country_flag = AIO_RE_create_storm_locating

			has_country_flag = AIO_RE_strike_system_locating
			has_country_flag = AIO_RE_erase_system_locating
			has_country_flag = AIO_RE_erase_star_cluster_locating
		}
	}
	dismantle_potential = { always = no }

	placement_rules = {
		solar_system = {
			custom_tooltip = {
				fail_text = AIO_requires_system_not_existed_storm
				NAND = {
					event_target:AIO_empire_country = { has_country_flag = AIO_RE_create_storm_locating }
					is_inside_storm = yes
				}
			}
		}
	}

	build_time = 1

	on_build_start = {
		event_target:AIO_locator_builder = { delete_fleet = this }
		clear_global_event_target = AIO_locator_builder

		from = {
			switch = {
				trigger = has_country_flag

				AIO_RE_enrich_system_deposits_locating = {
					remove_country_flag = AIO_RE_enrich_system_deposits_locating
					set_country_flag = AIO_RE_enrich_system_deposits_located
				}
				AIO_RE_create_storm_locating = {
					remove_country_flag = AIO_RE_create_storm_locating
					set_country_flag = AIO_RE_create_storm_located
				}

				AIO_RE_strike_system_locating = {
					remove_country_flag = AIO_RE_strike_system_locating
					set_country_flag = AIO_RE_strike_system_located
				}
				AIO_RE_erase_system_locating = {
					remove_country_flag = AIO_RE_erase_system_locating
					set_country_flag = AIO_RE_erase_system_located

					# 记录信息
					root = {
						set_variable = { which = AIO_RE_erase_system_planet_num value = trigger:count_system_planet }
						set_variable = { which = AIO_RE_erase_system_colony_num value = trigger:count_system_colony }
						set_variable = { which = AIO_RE_erase_system_mega_num value = trigger:count_system_megastructure }
					}
				}
				AIO_RE_erase_star_cluster_locating = {
					remove_country_flag = AIO_RE_erase_star_cluster_locating
					set_country_flag = AIO_RE_erase_star_cluster_located
				}
			}

			root = { save_global_event_target_as = AIO_RE_target }
			country_event = { id = AIO_RE_events.201 }
		}
	}

	on_build_complete = { remove_megastructure = fromfrom }
}

AIO_mega_planet_locator = {
	entity = "none"
	construction_entity = "none"
	place_entity_on_planet_plane = yes

	portrait = "GFX_megastructure_spy_orb_background"

	potential = {
		OR = {
			has_country_flag = AIO_RE_change_pc_locating

			has_country_flag = AIO_RE_erase_planet_locating
		}
	}
	placement_rules = {
		planet_possible = {
			custom_tooltip = {
				fail_text = AIO_requires_not_Cetana_captial
				NOT = { has_planet_flag = synth_queen_bastille }
			}
		}
	}
	dismantle_potential = { always = no }

	build_time = 1

	on_build_start = {
		event_target:AIO_locator_builder = { delete_fleet = this }
		clear_global_event_target = AIO_locator_builder

		from = {
			switch = {
				trigger = has_country_flag
				AIO_RE_change_pc_locating = {
					remove_country_flag = AIO_RE_change_pc_locating
					set_country_flag = AIO_RE_change_pc_located
				}

				AIO_RE_erase_planet_locating = {
					remove_country_flag = AIO_RE_erase_planet_locating
					set_country_flag = AIO_RE_erase_planet_located
				}
			}

			root.fromfrom.planet = { save_global_event_target_as = AIO_RE_target }
			country_event = { id = AIO_RE_events.201 }
		}
	}

	on_build_complete = { remove_megastructure = fromfrom }
}

AIO_mega_colony_locator = {
	entity = "none"
	construction_entity = "none"
	place_entity_on_planet_plane = yes

	portrait = "GFX_megastructure_spy_orb_background"

	potential = {
		OR = {
			has_country_flag = AIO_RE_degenerate_locating
			has_country_flag = AIO_RE_enlighten_locating
			has_country_flag = AIO_RE_turn_back_time_locating

			has_country_flag = AIO_RE_destroy_planet_army_locating
		}
	}
	dismantle_potential = { always = no }

	placement_rules = {
		planet_possible = {
			custom_tooltip = {
				fail_text = AIO_requires_is_colony
				is_colony = yes
			}
			custom_tooltip = {
				fail_text = AIO_requires_not_Cetana_captial
				NOT = { has_planet_flag = synth_queen_bastille }
			}
		}
	}

	build_time = 1

	on_build_start = {
		event_target:AIO_locator_builder = { delete_fleet = this }
		clear_global_event_target = AIO_locator_builder

		from = {
			switch = {
				trigger = has_country_flag
				AIO_RE_degenerate_locating = {
					remove_country_flag = AIO_RE_degenerate_locating
					set_country_flag = AIO_RE_degenerate_located
				}
				AIO_RE_enlighten_locating = {
					remove_country_flag = AIO_RE_enlighten_locating
					set_country_flag = AIO_RE_enlighten_located
				}
				AIO_RE_turn_back_time_locating = {
					remove_country_flag = AIO_RE_turn_back_time_locating
					set_country_flag = AIO_RE_turn_back_time_located
				}

				AIO_RE_destroy_planet_army_locating = {
					remove_country_flag = AIO_RE_destroy_planet_army_locating
					set_country_flag = AIO_RE_destroy_planet_army_located

					# 记录信息
					root.fromfrom.planet = {
						set_variable = { which = AIO_RE_destroy_planet_army_num value = trigger:count_planet_army }
					}
				}
			}

			root.fromfrom.planet = { save_global_event_target_as = AIO_RE_target }
			country_event = { id = AIO_RE_events.201 }
		}
	}

	on_build_complete = { remove_megastructure = fromfrom }
}
